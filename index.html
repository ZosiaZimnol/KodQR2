<script>
    const canvas = document.getElementById('scratchCanvas');
    const ctx = canvas.getContext('2d');
    const message = document.getElementById('message');
    let isScratching = false;

    // Ustawienia canvas
    function resizeCanvas() {
        canvas.width = canvas.offsetWidth;
        canvas.height = canvas.offsetHeight;
    }
    resizeCanvas();

    // Rysowanie warstwy zdrapki
    ctx.fillStyle = '#888'; // Kolor szary dla zdrapki
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Funkcja zdrapywania
    function scratch(e) {
        if (!isScratching) return;

        const rect = canvas.getBoundingClientRect();
        const x = (e.clientX || e.touches[0].clientX) - rect.left;
        const y = (e.clientY || e.touches[0].clientY) - rect.top;

        ctx.globalCompositeOperation = 'destination-out'; // Usuwanie obszaru
        ctx.beginPath();
        ctx.arc(x, y, 15, 0, Math.PI * 2, false);
        ctx.fill();

        checkScratchCompletion();
    }

    // Funkcja sprawdzająca, czy zdrapano 70%
    function checkScratchCompletion() {
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
        const pixels = imageData.data;
        let transparentPixels = 0;

        for (let i = 3; i < pixels.length; i += 4) {
            if (pixels[i] === 0) transparentPixels++;
        }

        const scratchedPercentage = transparentPixels / (pixels.length / 4);
        if (scratchedPercentage > 0.5) {
            revealMessage();
        }
    }

    // Funkcja wyświetlająca wiadomość
    function revealMessage() {
        canvas.style.display = 'none'; // Ukryj zdrapkę
        message.style.display = 'block'; // Pokaż wiadomość
        generateConfetti();
    }

    // Funkcja generująca konfetti
    function generateConfetti() {
        for (let i = 0; i < 50; i++) { // Adjusted the number of confetti pieces
            const confetti = document.createElement('div');
            confetti.classList.add('confetti');
            confetti.style.backgroundColor = getRandomColor();
            confetti.style.left = Math.random() * 100 + 'vw';
            confetti.style.top = Math.random() * -100 + 'px';
            confetti.style.animationDuration = Math.random() * 3 + 2 + 's';
            document.body.appendChild(confetti);

            confetti.addEventListener('animationend', () => {
                confetti.remove();
            });
        }
    }

    // Funkcja generująca losowe kolory
    function getRandomColor() {
        const colors = ['#FF5733', '#33FF57', '#3357FF', '#FF33A6', '#FFFF33'];
        return colors[Math.floor(Math.random() * colors.length)];
    }

    // Obsługa zdarzeń myszy
    canvas.addEventListener('mousedown', () => isScratching = true);
    canvas.addEventListener('mouseup', () => isScratching = false);
    canvas.addEventListener('mousemove', scratch);

    // Obsługa zdarzeń dotyku
    canvas.addEventListener('touchstart', () => isScratching = true);
    canvas.addEventListener('touchend', () => isScratching = false);
    canvas.addEventListener('touchmove', scratch);

    // Dopasowanie canvas przy zmianie okna
    window.addEventListener('resize', () => {
        resizeCanvas();
        ctx.fillStyle = '#888';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
    });
</script>
